# 에러와 빈 데이터 구분 처리 개선

## 📅 작성일
2025-01-16

---

## 🎯 개선 목적

사용자가 **"API 에러로 인한 실패"**와 **"데이터가 단순히 없는 상태"**를 명확히 구분할 수 있도록 개선

---

## 📊 개선 전 문제점

### 문제 상황
```
사용자 피드백:
"모든 메뉴에서 아무 데이터가 없을 때
'대시보드 데이터를 불러오는데 실패했습니다.'
오류로 인한 실패인건지 확인이 필요해."
```

### 기존 동작
1. **데이터가 없을 때**: 빈 테이블/카드 표시 (정상)
2. **API 에러 발생 시**: 에러 상태가 있어도 UI에 표시되지 않음
3. **사용자 혼란**: 에러인지 데이터가 없는 것인지 구분 불가

---

## ✅ 개선 내용

### 1. 에러 상태 관리 강화

모든 목록 페이지에서:
```typescript
const [error, setError] = useState('');

const fetchData = async () => {
  setLoading(true);
  setError(''); // 에러 초기화
  try {
    const response = await api.get(...);
    setData(response.content);
  } catch (err: any) {
    console.error('Failed to fetch:', err);
    // 사용자 친화적 에러 메시지
    setError(err.response?.data?.message || '데이터를 불러오는데 실패했습니다.');
  } finally {
    setLoading(false);
  }
};
```

### 2. UI에 에러 Alert 표시

```typescript
return (
  <Box>
    <Typography variant="h4">페이지 제목</Typography>
    
    {/* 에러 발생 시 명확한 Alert 표시 */}
    {error && (
      <Alert severity="error" sx={{ mb: 2 }}>
        {error}
      </Alert>
    )}
    
    {/* 데이터 표시 영역 */}
    {loading ? (
      <CircularProgress />
    ) : data.length === 0 ? (
      <Typography>데이터가 없습니다.</Typography>
    ) : (
      // 데이터 표시
    )}
  </Box>
);
```

---

## 🎨 사용자 경험 개선

### Case 1: 데이터가 없을 때 (정상 상태)
```
┌─────────────────────────────────┐
│ 프로젝트 관리         [등록] │
├─────────────────────────────────┤
│                                 │
│   데이터가 없습니다.           │
│                                 │
└─────────────────────────────────┘
```

### Case 2: API 에러 발생 시
```
┌─────────────────────────────────┐
│ 프로젝트 관리         [등록] │
├─────────────────────────────────┤
│ ⚠️ 프로젝트 목록을 불러오는데    │
│    실패했습니다.                │
├─────────────────────────────────┤
│                                 │
│   (빈 테이블 또는 카드)        │
│                                 │
└─────────────────────────────────┘
```

### Case 3: 로딩 중
```
┌─────────────────────────────────┐
│ 프로젝트 관리         [등록] │
├─────────────────────────────────┤
│                                 │
│         ⏳ 로딩 중...           │
│                                 │
└─────────────────────────────────┘
```

---

## 📁 수정된 파일

### 1. ✅ ProjectListPage.tsx
- `error` 상태 추가
- `setError('')` 초기화 추가
- catch 블록에서 에러 메시지 설정
- Alert 컴포넌트 추가

### 2. ✅ SRListPage.tsx
- Alert 컴포넌트 추가 (error 상태는 이미 존재)

### 3. ✅ 기타 목록 페이지들
다음 페이지들은 이미 error 상태와 Alert가 구현되어 있음:
- SpecListPage.tsx
- ApprovalListPage.tsx
- IssueListPage.tsx
- ReleaseListPage.tsx
- IncidentListPage.tsx
- PartnerListPage.tsx
- AssetListPage.tsx

---

## 🔍 에러 메시지 종류

### Backend API 에러 응답
```json
{
  "code": "C999",
  "message": "서버 오류가 발생했습니다.",
  "timestamp": "2025-01-16T10:00:00"
}
```

### Frontend 에러 메시지 매핑
```typescript
// Backend 메시지 우선 사용
setError(err.response?.data?.message || 

// Fallback: 도메인별 기본 메시지
'프로젝트 목록을 불러오는데 실패했습니다.');
```

### 에러 메시지 예시
| 페이지 | 에러 메시지 |
|--------|------------|
| 프로젝트 | "프로젝트 목록을 불러오는데 실패했습니다." |
| SR 관리 | "SR 목록을 불러오는데 실패했습니다." |
| SPEC 관리 | "SPEC 목록을 불러오는데 실패했습니다." |
| 승인 관리 | "승인 목록을 불러오는데 실패했습니다." |
| 이슈 관리 | "이슈 목록을 불러오는데 실패했습니다." |
| 릴리즈 | "릴리즈 목록을 불러오는데 실패했습니다." |
| 장애 관리 | "장애 목록을 불러오는데 실패했습니다." |
| 파트너 | "파트너 목록을 불러오는데 실패했습니다." |
| 자산 관리 | "자산 목록을 불러오는데 실패했습니다." |
| 대시보드 | "대시보드 데이터를 불러오는데 실패했습니다." |

---

## 🧪 테스트 시나리오

### Scenario 1: 정상 - 데이터 있음
1. 페이지 접속
2. 로딩 인디케이터 표시
3. 데이터 로드 성공
4. 테이블/카드에 데이터 표시

**예상 결과**: ✅ 에러 없음, 데이터 정상 표시

### Scenario 2: 정상 - 데이터 없음
1. 페이지 접속
2. 로딩 인디케이터 표시
3. API 응답: `{ content: [], totalElements: 0 }`
4. "데이터가 없습니다." 메시지 표시

**예상 결과**: ✅ 에러 없음, 빈 상태 메시지 표시

### Scenario 3: 비정상 - API 에러
1. 페이지 접속
2. 로딩 인디케이터 표시
3. API 에러 발생 (500, 401, 403 등)
4. 에러 Alert 표시

**예상 결과**: ⚠️ 빨간색 Alert에 에러 메시지 표시

### Scenario 4: 비정상 - 네트워크 에러
1. Backend 서비스 중지
2. 페이지 접속
3. 네트워크 에러 발생
4. "데이터를 불러오는데 실패했습니다." Alert 표시

**예상 결과**: ⚠️ 네트워크 에러 메시지 표시

---

## 🎯 확인 방법

### 1. 정상 상태 확인
```bash
# 서비스 시작
docker-compose up -d

# 브라우저 접속
http://localhost:3000

# 로그인 후 각 메뉴 확인
# → 데이터 없음: "데이터가 없습니다." 표시
```

### 2. API 에러 상황 테스트
```bash
# Backend 중지
docker-compose stop backend

# 브라우저에서 페이지 새로고침
# → 빨간색 Alert: "목록을 불러오는데 실패했습니다."
```

### 3. 개별 API 에러 테스트
```bash
# 특정 API에 잘못된 요청
TOKEN="invalid_token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/projects

# 브라우저 확인
# → "인증이 필요합니다." 또는 적절한 에러 메시지
```

---

## 📊 개선 효과

### Before (개선 전)
- ❌ 에러 발생해도 사용자는 알 수 없음
- ❌ "데이터가 없나?" vs "에러가 발생했나?" 혼란
- ❌ 콘솔만 확인 가능 (일반 사용자는 확인 불가)

### After (개선 후)
- ✅ 에러 발생 시 즉시 빨간색 Alert 표시
- ✅ 명확한 에러 메시지
- ✅ 데이터 없음과 에러 명확히 구분
- ✅ 사용자 친화적 피드백

---

## 🚀 추가 개선 사항

### 향후 고려사항
1. **Retry 버튼 추가**
   ```typescript
   {error && (
     <Alert severity="error" action={
       <Button color="inherit" size="small" onClick={fetchData}>
         재시도
       </Button>
     }>
       {error}
     </Alert>
   )}
   ```

2. **에러 타입별 세분화**
   - 401: "로그인이 필요합니다."
   - 403: "권한이 없습니다."
   - 404: "데이터를 찾을 수 없습니다."
   - 500: "서버 오류가 발생했습니다."
   - Network: "네트워크 연결을 확인해주세요."

3. **Toast 알림 추가**
   - 에러 발생 시 상단에 Toast 메시지
   - 자동 사라짐 (3-5초)

4. **에러 로깅 서비스 연동**
   - Sentry, LogRocket 등
   - 실시간 에러 모니터링

---

## 📝 결론

### 달성 목표
✅ **"오류로 인한 실패인지 확인 가능"**

### 사용자 경험 개선
- 에러와 빈 데이터를 명확히 구분
- 사용자 친화적 에러 메시지
- 즉각적인 피드백 제공

### 개발자 경험 개선
- 일관된 에러 처리 패턴
- 디버깅 용이
- 유지보수 편리

---

**Status**: ✅ 완료
**Last Updated**: 2025-01-16
**Tested**: ✅ 로컬 환경
**Deployed**: ✅ Docker Container







